import { Directive, Input, forwardRef } from '@angular/core';
import { NG_VALIDATORS } from '@angular/forms';
import { APP_VALIDATORS } from '../../const/app-validators.const';
import { BaseValidator } from './base-validator.directive';
import { ELEMENT_VALUE, BLUR, FOCUS, BLANK } from "../../const";
import { TEMPLATE_VALIDATION_CONFIG, CONDITIONAL_VALIDATOR, VALIDATOR_CONFIG } from '../../const/app.const';
import { ApplicationUtil } from '../../util/app-util';
import { RegexValidator } from '../../util';
import { MaskProvider } from '../../domain/element-processor/mask.provider';
import * as i0 from "@angular/core";
import * as i1 from "../../domain/element-processor/decimal.provider";
const NGMODEL_BINDING = {
    provide: NG_VALIDATORS,
    useExisting: forwardRef(() => RxFormControlDirective),
    multi: true
};
const ALLOW_VALIDATOR_WITHOUT_CONFIG = ['required', 'notEmpty', 'alpha', 'alphaNumeric', 'ascii', 'dataUri', 'digit', 'email', 'even', 'hexColor', 'json', 'latitude', 'latLong', 'leapYear', 'longitude', 'lowerCase', 'mac', 'odd', 'port', 'primeNumber', 'time', 'upperCase', 'url', 'unique', 'cusip', 'gird'];
const NUMERIC = "numeric";
const IS_FORMAT = "isFormat";
const DIGITS_INFO = "digitsInfo";
export class RxFormControlDirective extends BaseValidator {
    constructor(elementRef, renderer, decimalProvider) {
        super();
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.decimalProvider = decimalProvider;
        this.eventListeners = [];
        this.isNumericSubscribed = false;
        this.isFocusCalled = false;
        this.isMasked = false;
        this.element = elementRef.nativeElement;
        this.setEventName();
    }
    set validationControls(value) {
        this.controls = value;
    }
    get validationControls() {
        return this.controls;
    }
    ngOnInit() {
        let validators = [];
        Object.keys(APP_VALIDATORS).forEach(validatorName => {
            if ((this[`rx${validatorName}`]) || (ALLOW_VALIDATOR_WITHOUT_CONFIG.indexOf(validatorName) != -1 && this[`rx${validatorName}`] == BLANK)) {
                validators.push(APP_VALIDATORS[validatorName](this[`rx${validatorName}`]));
                if (this.name && !(this.formControlName && this.formControl)) {
                    ApplicationUtil.configureControl(this.controlConfig, this[`rx${validatorName}`], validatorName);
                }
            }
        });
        if (validators.length > 0)
            this.validators = validators;
        if (this.rxnumeric && (this.rxnumeric.isFormat || this.rxnumeric.digitsInfo)) {
            this.bindNumericElementEvent();
        }
    }
    blurEvent() {
        if (!(this.formControl && this.formControl.errors && this.formControl.errors.numeric)) {
            if (this.formControl.value !== null && this.formControl.value !== undefined) {
                let value = this.decimalProvider.transFormDecimal(this.formControl.value, this.rxnumeric.digitsInfo, this.rxnumeric.persistZero);
                value = (!this.rxnumeric.isFormat) ? this.decimalProvider.replacer(value) : value;
                this.setValueOnElement(value);
            }
            this.isFocusCalled = false;
        }
    }
    bindNumericElementEvent(config) {
        if (config)
            this.rxnumeric = config;
        let listener = this.renderer.listen(this.element, BLUR, this.blurEvent.bind(this));
        this.eventListeners.push(listener);
        listener = this.renderer.listen(this.element, FOCUS, (event) => {
            this.isFocusCalled = true;
            if (!(this.formControl && this.formControl.errors && this.formControl.errors.numeric) && this.formControl.value != null) {
                let value = this.decimalProvider.replacer(this.element.value);
                this.setValueOnElement(value);
            }
        });
        this.eventListeners.push(listener);
    }
    bindValueChangeEvent() {
        if (this.eventName != BLANK) {
            let listener = this.renderer.listen(this.element, this.eventName, () => {
                Object.keys(this.validationControls).forEach(fieldName => {
                    this.validationControls[fieldName].updateValueAndValidity();
                });
            });
            this.eventListeners.push(listener);
        }
    }
    subscribeNumericFormatter() {
        if (this.formControl[VALIDATOR_CONFIG] && this.formControl[VALIDATOR_CONFIG][NUMERIC] && (this.formControl[VALIDATOR_CONFIG][NUMERIC][IS_FORMAT] || this.formControl[VALIDATOR_CONFIG][NUMERIC][DIGITS_INFO])) {
            if (!this.isNumericSubscribed) {
                this.bindNumericElementEvent(this.formControl[VALIDATOR_CONFIG][NUMERIC]);
                this.isNumericSubscribed = true;
            }
            if (!this.isFocusCalled && RegexValidator.isNotBlank(this.formControl.value)) {
                this.blurEvent();
            }
        }
    }
    subscribeMaskValidator() {
        if (this.formControl[VALIDATOR_CONFIG] && this.formControl[VALIDATOR_CONFIG]["mask"] && !this.isMasked) {
            let config = this.formControl[VALIDATOR_CONFIG]["mask"];
            this.maskProvider = new MaskProvider(this.element, config.mask, this.renderer, this.formControl, config);
            this.isMasked = true;
        }
    }
    setValueOnElement(value) {
        this.renderer.setProperty(this.element, ELEMENT_VALUE, value);
    }
    setTemplateValidators(control) {
        for (let validatorName in control[VALIDATOR_CONFIG]) {
            this[validatorName] = control[VALIDATOR_CONFIG][validatorName];
        }
        delete control[TEMPLATE_VALIDATION_CONFIG];
        delete control[VALIDATOR_CONFIG];
        this.ngOnInit();
    }
    updateOnElementClass(element) {
        var previousClassName = '';
        return function (className) {
            if (previousClassName)
                element.classList.remove(previousClassName);
            if (className)
                element.classList.add(className);
            previousClassName = className;
        };
    }
    setValidatorConfig(control) {
        if (!this.formControl) {
            this.formControl = control;
            let rxFormControl = this.formControl;
            if (rxFormControl.updateOnElementClass)
                rxFormControl.updateOnElementClass = this.updateOnElementClass(this.element);
        }
        this.subscribeMaskValidator();
        this.subscribeNumericFormatter();
        if (control[TEMPLATE_VALIDATION_CONFIG])
            this.setTemplateValidators(control);
        if (control[CONDITIONAL_VALIDATOR]) {
            this.conditionalValidator = control[CONDITIONAL_VALIDATOR];
            delete control[CONDITIONAL_VALIDATOR];
        }
    }
    validate(control) {
        this.setValidatorConfig(control);
        if (this.conditionalValidator)
            this.conditionalValidator(control);
        if (!this.isProcessed)
            this.setModelConfig(control);
        return ((this.validators && this.validators.length > 0) || this.maskProvider) ? this.validation(control) : null;
    }
    ngOnDestroy() {
        this.controls = undefined;
        let eventCount = this.eventListeners.length;
        for (var i = 0; i < eventCount; i++) {
            this.eventListeners[0]();
            this.eventListeners.splice(0, 1);
        }
        this.eventListeners = [];
        if (this.maskProvider)
            this.maskProvider.onDestroy();
    }
}
RxFormControlDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: RxFormControlDirective, deps: [{ token: i0.ElementRef }, { token: i0.Renderer2 }, { token: i1.DecimalProvider }], target: i0.ɵɵFactoryTarget.Directive });
RxFormControlDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "14.3.0", type: RxFormControlDirective, selector: "[ngModel],[formControlName],[formControl]", inputs: { rxalpha: "rxalpha", rxalphaNumeric: "rxalphaNumeric", rxascii: "rxascii", rxcompare: "rxcompare", rxcompose: "rxcompose", rxcontains: "rxcontains", rxcreditCard: "rxcreditCard", rxdataUri: "rxdataUri", rxdifferent: "rxdifferent", rxdigit: "rxdigit", rxemail: "rxemail", rxendsWith: "rxendsWith", rxeven: "rxeven", rxextension: "rxextension", rxfactor: "rxfactor", rxfileSize: "rxfileSize", rxgreaterThanEqualTo: "rxgreaterThanEqualTo", rxgreaterThan: "rxgreaterThan", rxhexColor: "rxhexColor", rxjson: "rxjson", rxlatitude: "rxlatitude", rxlatLong: "rxlatLong", rxleapYear: "rxleapYear", rxlessThan: "rxlessThan", rxlessThanEqualTo: "rxlessThanEqualTo", rxlongitude: "rxlongitude", rxlowerCase: "rxlowerCase", rxmac: "rxmac", rxmaxDate: "rxmaxDate", rxmaxLength: "rxmaxLength", rxmaxNumber: "rxmaxNumber", rxminDate: "rxminDate", rxminLength: "rxminLength", rxminNumber: "rxminNumber", rxnumeric: "rxnumeric", rxodd: "rxodd", rxpassword: "rxpassword", rxport: "rxport", rxprimeNumber: "rxprimeNumber", rxrequired: "rxrequired", rxrange: "rxrange", rxrule: "rxrule", rxstartsWith: "rxstartsWith", rxtime: "rxtime", rxupperCase: "rxupperCase", rxurl: "rxurl", rxunique: "rxunique", rxnotEmpty: "rxnotEmpty", rxcusip: "rxcusip", rxgrid: "rxgrid", rxdate: "rxdate" }, providers: [NGMODEL_BINDING], usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: RxFormControlDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[ngModel],[formControlName],[formControl]',
                    providers: [NGMODEL_BINDING],
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i1.DecimalProvider }]; }, propDecorators: { rxalpha: [{
                type: Input
            }], rxalphaNumeric: [{
                type: Input
            }], rxascii: [{
                type: Input
            }], rxcompare: [{
                type: Input
            }], rxcompose: [{
                type: Input
            }], rxcontains: [{
                type: Input
            }], rxcreditCard: [{
                type: Input
            }], rxdataUri: [{
                type: Input
            }], rxdifferent: [{
                type: Input
            }], rxdigit: [{
                type: Input
            }], rxemail: [{
                type: Input
            }], rxendsWith: [{
                type: Input
            }], rxeven: [{
                type: Input
            }], rxextension: [{
                type: Input
            }], rxfactor: [{
                type: Input
            }], rxfileSize: [{
                type: Input
            }], rxgreaterThanEqualTo: [{
                type: Input
            }], rxgreaterThan: [{
                type: Input
            }], rxhexColor: [{
                type: Input
            }], rxjson: [{
                type: Input
            }], rxlatitude: [{
                type: Input
            }], rxlatLong: [{
                type: Input
            }], rxleapYear: [{
                type: Input
            }], rxlessThan: [{
                type: Input
            }], rxlessThanEqualTo: [{
                type: Input
            }], rxlongitude: [{
                type: Input
            }], rxlowerCase: [{
                type: Input
            }], rxmac: [{
                type: Input
            }], rxmaxDate: [{
                type: Input
            }], rxmaxLength: [{
                type: Input
            }], rxmaxNumber: [{
                type: Input
            }], rxminDate: [{
                type: Input
            }], rxminLength: [{
                type: Input
            }], rxminNumber: [{
                type: Input
            }], rxnumeric: [{
                type: Input
            }], rxodd: [{
                type: Input
            }], rxpassword: [{
                type: Input
            }], rxport: [{
                type: Input
            }], rxprimeNumber: [{
                type: Input
            }], rxrequired: [{
                type: Input
            }], rxrange: [{
                type: Input
            }], rxrule: [{
                type: Input
            }], rxstartsWith: [{
                type: Input
            }], rxtime: [{
                type: Input
            }], rxupperCase: [{
                type: Input
            }], rxurl: [{
                type: Input
            }], rxunique: [{
                type: Input
            }], rxnotEmpty: [{
                type: Input
            }], rxcusip: [{
                type: Input
            }], rxgrid: [{
                type: Input
            }], rxdate: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnhmb3JtY29udHJvbC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9yZWFjdGl2ZS1mb3JtLXZhbGlkYXRvcnMvZGlyZWN0aXZlcy90ZW1wbGF0ZS12YWxpZGF0aW9ucy9yeGZvcm1jb250cm9sLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBYyxVQUFVLEVBQWdDLE1BQU0sZUFBZSxDQUFDO0FBQ3ZHLE9BQU8sRUFBYSxhQUFhLEVBQWdDLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEYsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUMzRCxPQUFPLEVBQ0YsYUFBYSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUNyQyxNQUFNLGFBQWEsQ0FBQztBQUNyQixPQUFPLEVBQUUsMEJBQTBCLEVBQUMscUJBQXFCLEVBQUMsZ0JBQWdCLEVBQUcsTUFBTSx1QkFBdUIsQ0FBQTtBQUMxRyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFHdEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUU1QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sOENBQThDLENBQUM7OztBQUc1RSxNQUFNLGVBQWUsR0FBUTtJQUN6QixPQUFPLEVBQUUsYUFBYTtJQUN0QixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLHNCQUFzQixDQUFDO0lBQ3JELEtBQUssRUFBRSxJQUFJO0NBQ2QsQ0FBQztBQUVGLE1BQU0sOEJBQThCLEdBQUcsQ0FBQyxVQUFVLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsT0FB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QVc7c0JBQW5CLEtBQUs7Z0JBQ0csV0FBVztzQkFBbkIsS0FBSztnQkFDRyxTQUFTO3NCQUFqQixLQUFLO2dCQUNHLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxVQUFVO3NCQUFsQixLQUFLO2dCQUNHLE1BQU07c0JBQWQsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBQ0csT0FBTztzQkFBZixLQUFLO2dCQUNHLE1BQU07c0JBQWQsS0FBSztnQkFDRyxZQUFZO3NCQUFwQixLQUFLO2dCQUNHLE1BQU07c0JBQWQsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNHLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBQ0csT0FBTztzQkFBZixLQUFLO2dCQUNHLE1BQU07c0JBQWQsS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIElucHV0LCBFbGVtZW50UmVmLCBmb3J3YXJkUmVmLCBPbkluaXQsIE9uRGVzdHJveSwgUmVuZGVyZXIyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFZhbGlkYXRvciwgTkdfVkFMSURBVE9SUywgQWJzdHJhY3RDb250cm9sLCBGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgQVBQX1ZBTElEQVRPUlMgfSBmcm9tICcuLi8uLi9jb25zdC9hcHAtdmFsaWRhdG9ycy5jb25zdCc7XHJcbmltcG9ydCB7IEJhc2VWYWxpZGF0b3IgfSBmcm9tICcuL2Jhc2UtdmFsaWRhdG9yLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7XHJcbiAgICAgRUxFTUVOVF9WQUxVRSwgQkxVUiwgRk9DVVMsIEJMQU5LXHJcbn0gZnJvbSBcIi4uLy4uL2NvbnN0XCI7XHJcbmltcG9ydCB7IFRFTVBMQVRFX1ZBTElEQVRJT05fQ09ORklHLENPTkRJVElPTkFMX1ZBTElEQVRPUixWQUxJREFUT1JfQ09ORklHICB9IGZyb20gJy4uLy4uL2NvbnN0L2FwcC5jb25zdCdcclxuaW1wb3J0IHsgQXBwbGljYXRpb25VdGlsIH0gZnJvbSAnLi4vLi4vdXRpbC9hcHAtdXRpbCc7XHJcbmltcG9ydCB7IERlY2ltYWxQcm92aWRlciB9IGZyb20gXCIuLi8uLi9kb21haW4vZWxlbWVudC1wcm9jZXNzb3IvZGVjaW1hbC5wcm92aWRlclwiXHJcbmltcG9ydCB7IEFscGhhQ29uZmlnLCBBcnJheUNvbmZpZywgQmFzZUNvbmZpZywgQ2hvaWNlQ29uZmlnLCBDb21wYXJlQ29uZmlnLCBDb21wb3NlQ29uZmlnLCBDb250YWluc0NvbmZpZywgQ3JlZGl0Q2FyZENvbmZpZywgRGF0ZUNvbmZpZywgRGVmYXVsdENvbmZpZywgRGlnaXRDb25maWcsIEVtYWlsQ29uZmlnLCBFeHRlbnNpb25Db25maWcsIEZhY3RvckNvbmZpZywgTWVzc2FnZUNvbmZpZywgTnVtYmVyQ29uZmlnLCBOdW1lcmljQ29uZmlnLCBQYXNzd29yZENvbmZpZywgUmFuZ2VDb25maWcsIFJlcXVpcmVkQ29uZmlnLCBSdWxlQ29uZmlnLCBTaXplQ29uZmlnLCBUaW1lQ29uZmlnLCBEaWZmZXJlbnRDb25maWcsIFJlbGF0aW9uYWxPcGVyYXRvckNvbmZpZywgVW5pcXVlQ29uZmlnIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2NvbmZpZydcclxuaW1wb3J0IHsgUmVnZXhWYWxpZGF0b3IgfSBmcm9tICcuLi8uLi91dGlsJztcclxuaW1wb3J0IHsgUnhGb3JtQ29udHJvbCB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9mb3JtLWNvbnRyb2xcIjtcclxuaW1wb3J0IHsgTWFza1Byb3ZpZGVyIH0gZnJvbSAnLi4vLi4vZG9tYWluL2VsZW1lbnQtcHJvY2Vzc29yL21hc2sucHJvdmlkZXInO1xyXG5cclxuXHJcbmNvbnN0IE5HTU9ERUxfQklORElORzogYW55ID0ge1xyXG4gICAgcHJvdmlkZTogTkdfVkFMSURBVE9SUyxcclxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFJ4Rm9ybUNvbnRyb2xEaXJlY3RpdmUpLFxyXG4gICAgbXVsdGk6IHRydWVcclxufTtcclxuXHJcbmNvbnN0IEFMTE9XX1ZBTElEQVRPUl9XSVRIT1VUX0NPTkZJRyA9IFsncmVxdWlyZWQnLCAnbm90RW1wdHknLCAnYWxwaGEnLCAnYWxwaGFOdW1lcmljJywgJ2FzY2lpJywgJ2RhdGFVcmknLCAnZGlnaXQnLCAnZW1haWwnLCAnZXZlbicsICdoZXhDb2xvcicsICdqc29uJywgJ2xhdGl0dWRlJywgJ2xhdExvbmcnLCAnbGVhcFllYXInLCAnbG9uZ2l0dWRlJywgJ2xvd2VyQ2FzZScsICdtYWMnLCAnb2RkJywgJ3BvcnQnLCAncHJpbWVOdW1iZXInLCAndGltZScsICd1cHBlckNhc2UnLCAndXJsJywgJ3VuaXF1ZScsJ2N1c2lwJywnZ2lyZCddO1xyXG5jb25zdCBOVU1FUklDOnN0cmluZyA9IFwibnVtZXJpY1wiO1xyXG5jb25zdCBJU19GT1JNQVQ6c3RyaW5nID0gXCJpc0Zvcm1hdFwiO1xyXG5jb25zdCBESUdJVFNfSU5GTzogc3RyaW5nID0gXCJkaWdpdHNJbmZvXCI7XHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbbmdNb2RlbF0sW2Zvcm1Db250cm9sTmFtZV0sW2Zvcm1Db250cm9sXScsXHJcbiAgICBwcm92aWRlcnM6IFtOR01PREVMX0JJTkRJTkddLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgUnhGb3JtQ29udHJvbERpcmVjdGl2ZSBleHRlbmRzIEJhc2VWYWxpZGF0b3IgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgVmFsaWRhdG9yIHtcclxuICAgIHByaXZhdGUgZXZlbnRMaXN0ZW5lcnM6IGFueVtdID0gW107XHJcbiAgICBwcml2YXRlIGlzTnVtZXJpY1N1YnNjcmliZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgaXNGb2N1c0NhbGxlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBpc01hc2tlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAgIFxyXG4gICAgc2V0IHZhbGlkYXRpb25Db250cm9scyh2YWx1ZTogeyBba2V5OiBzdHJpbmddOiBGb3JtQ29udHJvbCB9KSB7XHJcbiAgICAgICAgdGhpcy5jb250cm9scyA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB2YWxpZGF0aW9uQ29udHJvbHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udHJvbHM7XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KCkgcnhhbHBoYTogQWxwaGFDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGFscGhhTnVtZXJpYzogQWxwaGFDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGFzY2lpOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhjb21wYXJlOiBDb21wYXJlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhjb21wb3NlOiBDb21wb3NlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhjb250YWluczogQ29udGFpbnNDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGNyZWRpdENhcmQ6IENyZWRpdENhcmRDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGRhdGFVcmk6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGRpZmZlcmVudDogRGlmZmVyZW50Q29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhkaWdpdDogRGlnaXRDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGVtYWlsOiBFbWFpbENvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4ZW5kc1dpdGg6IERlZmF1bHRDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGV2ZW46IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGV4dGVuc2lvbjogRXh0ZW5zaW9uQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhmYWN0b3I6IEZhY3RvckNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4ZmlsZVNpemU6IFNpemVDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGdyZWF0ZXJUaGFuRXF1YWxUbzogUmVsYXRpb25hbE9wZXJhdG9yQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhncmVhdGVyVGhhbjogUmVsYXRpb25hbE9wZXJhdG9yQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhoZXhDb2xvcjogTWVzc2FnZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4anNvbjogRGVmYXVsdENvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4bGF0aXR1ZGU6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGxhdExvbmc6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGxlYXBZZWFyOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhsZXNzVGhhbjogUmVsYXRpb25hbE9wZXJhdG9yQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhsZXNzVGhhbkVxdWFsVG86IFJlbGF0aW9uYWxPcGVyYXRvckNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4bG9uZ2l0dWRlOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhsb3dlckNhc2U6IE1lc3NhZ2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeG1hYzogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4bWF4RGF0ZTogRGF0ZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4bWF4TGVuZ3RoOiBOdW1iZXJDb25maWc7XHJcbiAgICBASW5wdXQoKSByeG1heE51bWJlcjogTnVtYmVyQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhtaW5EYXRlOiBEYXRlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhtaW5MZW5ndGg6IE51bWJlckNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4bWluTnVtYmVyOiBOdW1iZXJDb25maWc7XHJcbiAgICBASW5wdXQoKSByeG51bWVyaWM6IE51bWVyaWNDb25maWc7XHJcbiAgICBASW5wdXQoKSByeG9kZDogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4cGFzc3dvcmQ6IFBhc3N3b3JkQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhwb3J0OiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhwcmltZU51bWJlcjogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4cmVxdWlyZWQ6IFJlcXVpcmVkQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhyYW5nZTogUmFuZ2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeHJ1bGU6IFJ1bGVDb25maWc7XHJcbiAgICBASW5wdXQoKSByeHN0YXJ0c1dpdGg6IERlZmF1bHRDb25maWc7XHJcbiAgICBASW5wdXQoKSByeHRpbWU6IFRpbWVDb25maWc7XHJcbiAgICBASW5wdXQoKSByeHVwcGVyQ2FzZTogTWVzc2FnZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4dXJsOiBEZWZhdWx0Q29uZmlnO1xyXG4gICAgQElucHV0KCkgcnh1bmlxdWU6IFVuaXF1ZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4bm90RW1wdHk6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGN1c2lwOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhncmlkOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhkYXRlOkJhc2VDb25maWc7XHJcblxyXG5cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLCBwcml2YXRlIGRlY2ltYWxQcm92aWRlcjogRGVjaW1hbFByb3ZpZGVyKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQgYXMgTm9kZTtcclxuICAgICAgICB0aGlzLnNldEV2ZW50TmFtZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIGxldCB2YWxpZGF0b3JzID0gW107XHJcbiAgICAgICAgT2JqZWN0LmtleXMoQVBQX1ZBTElEQVRPUlMpLmZvckVhY2godmFsaWRhdG9yTmFtZSA9PiB7XHJcbiAgICAgICAgICAgIGlmICgodGhpc1tgcngke3ZhbGlkYXRvck5hbWV9YF0pIHx8IChBTExPV19WQUxJREFUT1JfV0lUSE9VVF9DT05GSUcuaW5kZXhPZih2YWxpZGF0b3JOYW1lKSAhPSAtMSAmJiB0aGlzW2ByeCR7dmFsaWRhdG9yTmFtZX1gXSA9PSBCTEFOSykpIHtcclxuICAgICAgICAgICAgICAgIHZhbGlkYXRvcnMucHVzaChBUFBfVkFMSURBVE9SU1t2YWxpZGF0b3JOYW1lXSh0aGlzW2ByeCR7dmFsaWRhdG9yTmFtZX1gXSkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubmFtZSAmJiAhKHRoaXMuZm9ybUNvbnRyb2xOYW1lICYmIHRoaXMuZm9ybUNvbnRyb2wpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgQXBwbGljYXRpb25VdGlsLmNvbmZpZ3VyZUNvbnRyb2wodGhpcy5jb250cm9sQ29uZmlnLCB0aGlzW2ByeCR7dmFsaWRhdG9yTmFtZX1gXSwgdmFsaWRhdG9yTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICBpZiAodmFsaWRhdG9ycy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRvcnMgPSB2YWxpZGF0b3JzXHJcbiAgICAgICAgaWYgKHRoaXMucnhudW1lcmljICYmICh0aGlzLnJ4bnVtZXJpYy5pc0Zvcm1hdCB8fCB0aGlzLnJ4bnVtZXJpYy5kaWdpdHNJbmZvKSkge1xyXG4gICAgICAgICAgICB0aGlzLmJpbmROdW1lcmljRWxlbWVudEV2ZW50KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBibHVyRXZlbnQoKXtcclxuICAgICAgICBpZiAoISh0aGlzLmZvcm1Db250cm9sICYmIHRoaXMuZm9ybUNvbnRyb2wuZXJyb3JzICYmIHRoaXMuZm9ybUNvbnRyb2wuZXJyb3JzLm51bWVyaWMpKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZvcm1Db250cm9sLnZhbHVlICE9PSBudWxsICYmIHRoaXMuZm9ybUNvbnRyb2wudmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5kZWNpbWFsUHJvdmlkZXIudHJhbnNGb3JtRGVjaW1hbCh0aGlzLmZvcm1Db250cm9sLnZhbHVlLCB0aGlzLnJ4bnVtZXJpYy5kaWdpdHNJbmZvLCB0aGlzLnJ4bnVtZXJpYy5wZXJzaXN0WmVybyk7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9ICghdGhpcy5yeG51bWVyaWMuaXNGb3JtYXQpID8gdGhpcy5kZWNpbWFsUHJvdmlkZXIucmVwbGFjZXIodmFsdWUpIDogdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlT25FbGVtZW50KHZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmlzRm9jdXNDYWxsZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYmluZE51bWVyaWNFbGVtZW50RXZlbnQoY29uZmlnPzogTnVtZXJpY0NvbmZpZykge1xyXG4gICAgICAgIGlmIChjb25maWcpXHJcbiAgICAgICAgICAgIHRoaXMucnhudW1lcmljID0gY29uZmlnO1xyXG4gICAgICAgIGxldCBsaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuZWxlbWVudCwgQkxVUiwgdGhpcy5ibHVyRXZlbnQuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKGxpc3RlbmVyKVxyXG4gICAgICAgIGxpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5lbGVtZW50LCBGT0NVUywgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNGb2N1c0NhbGxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmICghKHRoaXMuZm9ybUNvbnRyb2wgJiYgdGhpcy5mb3JtQ29udHJvbC5lcnJvcnMgJiYgdGhpcy5mb3JtQ29udHJvbC5lcnJvcnMubnVtZXJpYykgJiYgdGhpcy5mb3JtQ29udHJvbC52YWx1ZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLmRlY2ltYWxQcm92aWRlci5yZXBsYWNlcih0aGlzLmVsZW1lbnQudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZU9uRWxlbWVudCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpXHJcbiAgICB9XHJcblxyXG4gICAgYmluZFZhbHVlQ2hhbmdlRXZlbnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZXZlbnROYW1lICE9IEJMQU5LKSB7XHJcbiAgICAgICAgICAgIGxldCBsaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuZWxlbWVudCwgdGhpcy5ldmVudE5hbWUsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMudmFsaWRhdGlvbkNvbnRyb2xzKS5mb3JFYWNoKGZpZWxkTmFtZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWxpZGF0aW9uQ29udHJvbHNbZmllbGROYW1lXS51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3Vic2NyaWJlTnVtZXJpY0Zvcm1hdHRlcigpIHtcclxuICAgICAgICBpZiAodGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXSAmJiB0aGlzLmZvcm1Db250cm9sW1ZBTElEQVRPUl9DT05GSUddW05VTUVSSUNdICYmICh0aGlzLmZvcm1Db250cm9sW1ZBTElEQVRPUl9DT05GSUddW05VTUVSSUNdW0lTX0ZPUk1BVF0gfHwgdGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXVtOVU1FUklDXVtESUdJVFNfSU5GT10pKSB7XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLmlzTnVtZXJpY1N1YnNjcmliZWQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iaW5kTnVtZXJpY0VsZW1lbnRFdmVudCh0aGlzLmZvcm1Db250cm9sW1ZBTElEQVRPUl9DT05GSUddW05VTUVSSUNdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNOdW1lcmljU3Vic2NyaWJlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoIXRoaXMuaXNGb2N1c0NhbGxlZCAmJiBSZWdleFZhbGlkYXRvci5pc05vdEJsYW5rKHRoaXMuZm9ybUNvbnRyb2wudmFsdWUpKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmx1ckV2ZW50KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgc3Vic2NyaWJlTWFza1ZhbGlkYXRvcigpIHtcclxuICAgICAgICBpZiAodGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXSAmJiB0aGlzLmZvcm1Db250cm9sW1ZBTElEQVRPUl9DT05GSUddW1wibWFza1wiXSAmJiAhdGhpcy5pc01hc2tlZCkge1xyXG4gICAgICAgICAgICBsZXQgY29uZmlnID0gdGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXVtcIm1hc2tcIl07XHJcbiAgICAgICAgICAgIHRoaXMubWFza1Byb3ZpZGVyID0gbmV3IE1hc2tQcm92aWRlcih0aGlzLmVsZW1lbnQsIGNvbmZpZy5tYXNrLCB0aGlzLnJlbmRlcmVyLCB0aGlzLmZvcm1Db250cm9sIGFzIEZvcm1Db250cm9sLCBjb25maWcpO1xyXG4gICAgICAgICAgICB0aGlzLmlzTWFza2VkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRWYWx1ZU9uRWxlbWVudCh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eSh0aGlzLmVsZW1lbnQsIEVMRU1FTlRfVkFMVUUsIHZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldFRlbXBsYXRlVmFsaWRhdG9ycyhjb250cm9sOkFic3RyYWN0Q29udHJvbCl7XHJcbiAgICAgICAgZm9yKGxldCB2YWxpZGF0b3JOYW1lIGluIGNvbnRyb2xbVkFMSURBVE9SX0NPTkZJR10pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzW3ZhbGlkYXRvck5hbWVdID0gY29udHJvbFtWQUxJREFUT1JfQ09ORklHXVt2YWxpZGF0b3JOYW1lXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVsZXRlIGNvbnRyb2xbVEVNUExBVEVfVkFMSURBVElPTl9DT05GSUddO1xyXG4gICAgICAgIGRlbGV0ZSBjb250cm9sW1ZBTElEQVRPUl9DT05GSUddXHJcbiAgICAgICAgdGhpcy5uZ09uSW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlT25FbGVtZW50Q2xhc3MoZWxlbWVudDogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICB2YXIgcHJldmlvdXNDbGFzc05hbWU6IHN0cmluZyA9ICcnO1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoY2xhc3NOYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICAgICAgaWYgKHByZXZpb3VzQ2xhc3NOYW1lKVxyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHByZXZpb3VzQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgaWYgKGNsYXNzTmFtZSlcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpXHJcbiAgICAgICAgICAgIHByZXZpb3VzQ2xhc3NOYW1lID0gY2xhc3NOYW1lO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgcHJpdmF0ZSBzZXRWYWxpZGF0b3JDb25maWcoY29udHJvbDpBYnN0cmFjdENvbnRyb2wpe1xyXG4gICAgICAgIGlmICghdGhpcy5mb3JtQ29udHJvbCkgeyBcclxuICAgICAgICAgICAgdGhpcy5mb3JtQ29udHJvbCA9IGNvbnRyb2w7XHJcbiAgICAgICAgICAgIGxldCByeEZvcm1Db250cm9sID0gdGhpcy5mb3JtQ29udHJvbCBhcyBSeEZvcm1Db250cm9sO1xyXG4gICAgICAgICAgICBpZiAocnhGb3JtQ29udHJvbC51cGRhdGVPbkVsZW1lbnRDbGFzcylcclxuICAgICAgICAgICAgICAgIHJ4Rm9ybUNvbnRyb2wudXBkYXRlT25FbGVtZW50Q2xhc3MgPSB0aGlzLnVwZGF0ZU9uRWxlbWVudENsYXNzKHRoaXMuZWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuc3Vic2NyaWJlTWFza1ZhbGlkYXRvcigpO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaWJlTnVtZXJpY0Zvcm1hdHRlcigpO1xyXG4gICAgaWYoY29udHJvbFtURU1QTEFURV9WQUxJREFUSU9OX0NPTkZJR10pXHJcbiAgICAgICAgdGhpcy5zZXRUZW1wbGF0ZVZhbGlkYXRvcnMoY29udHJvbCk7XHJcbiAgICBpZiAoY29udHJvbFtDT05ESVRJT05BTF9WQUxJREFUT1JdKSB7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25hbFZhbGlkYXRvciA9IGNvbnRyb2xbQ09ORElUSU9OQUxfVkFMSURBVE9SXTtcclxuICAgICAgICBkZWxldGUgY29udHJvbFtDT05ESVRJT05BTF9WQUxJREFUT1JdO1xyXG4gICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICB2YWxpZGF0ZShjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHtcclxuICAgICAgICB0aGlzLnNldFZhbGlkYXRvckNvbmZpZyhjb250cm9sKTtcclxuICAgICAgICBpZiAodGhpcy5jb25kaXRpb25hbFZhbGlkYXRvcilcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25hbFZhbGlkYXRvcihjb250cm9sKTtcclxuICAgICAgICBpZiAoIXRoaXMuaXNQcm9jZXNzZWQpXHJcbiAgICAgICAgICAgIHRoaXMuc2V0TW9kZWxDb25maWcoY29udHJvbCk7XHJcbiAgICAgICAgcmV0dXJuICgodGhpcy52YWxpZGF0b3JzICYmIHRoaXMudmFsaWRhdG9ycy5sZW5ndGggPiAwKSB8fCB0aGlzLm1hc2tQcm92aWRlcikgPyB0aGlzLnZhbGlkYXRpb24oY29udHJvbCkgOiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuY29udHJvbHMgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgbGV0IGV2ZW50Q291bnQgPSB0aGlzLmV2ZW50TGlzdGVuZXJzLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50Q291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzWzBdKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMuc3BsaWNlKDAsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMubWFza1Byb3ZpZGVyKVxyXG4gICAgICAgICAgICB0aGlzLm1hc2tQcm92aWRlci5vbkRlc3Ryb3koKTtcclxuICAgIH1cclxufVxyXG4iXX0=