<div class="page-header">
    <div class="page-block">
        <div class="row align-items-center">
            <div class="col-sm-12">
                <div class="page-header-title">
                    <h5 class="m-b-10">Create Invoice List </h5>
                </div>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="index.html">
                            <i class="feather icon-home"></i>
                        </a>
                    </li>
                    <li class="breadcrumb-item">
                        <a>Billing</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a>Invoice List</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a>Create Invoice List</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<app-card cardTitle="New Invoice" >
    <div class="row">
        <div class="col-sm-12">
            <div class="float-right mb-3">
                <button class="btn btn-success btn-sm btn-round has-ripple waves-effect waves-light " type="button" (click)="save()">
                    <span class="fa fa-save pr-1"></span>Save
                </button>&nbsp;
                <button class="btn btn-success btn-sm btn-round has-ripple waves-effect waves-light " type="button" (click)="onSaveandPost()">
                    <span class=" fa fa-save pr-1"></span>Save & Post
                </button>&nbsp;
                <button class="btn btn-success btn-sm btn-round has-ripple waves-effect waves-light " type="button" name="btnBack" id="btnBack" (click)=OnNav()>
                    <span class="fa fa-backward pr-1"></span>Back
                </button>
            </div>
        </div>
    </div>

    <app-card cardTitle="Invoice List">

        <!-- <div class="row">
            <div class="col-sm-12">
                <h6 class="col-xs-6 col-sm-4 text-left text-left-sm panel-title"><i
                        class="fa fa-user page-header-icon"></i>New Invoice</h6>
            </div>
        </div> -->

        <form [formGroup]="addinvoiceForm">
            <div class="panel-body">
                <div class="row">
                    <div class="col-sm-8">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <label class="col-form-label">Customer Name :<span
                                                    style="color: red">*</span></label>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="input-group">
                                                <input type="text" class="form-control " placeholder="Select Customer"
                                                    [(ngModel)]="InvoceObj.Fname" name="companyname"
                                                    [ngClass]="{'is-invalid':submitted && f.companyname.errors || !f.companyname.valid && f.companyname.touched && f.companyname.errors}"
                                                    formControlName="companyname">
                                                <div class="input-group-append">
                                                    <button class="input-group-text  btn-msg-send"
                                                        (click)="ShowCompanyModal=true" type="button">
                                                        <i class="fas fa-search"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <label class="col-form-label">Select Customer :<span
                                                    style="color: red">*</span></label>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="input-group">
                                                <select class="form-control" id="drpcompcontact" name="Email"
                                                    formControlName="email" [(ngModel)]="InvoceObj.Email">
                                                    <option value="">Please Select </option>
                                                    <option
                                                        *ngFor="let contactlist of contactdetailslist?.AccountObj | keyvalue"
                                                        [value]="contactlist.value.Email">{{contactlist.value.Name}}
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <label class="col-form-label">Bill To :</label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="input-group">
                                                <textarea class="form-control" name="billingAddress"
                                                    [value]="billingaddress" rows="14" formControlName="billingaddress">
                                                </textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <input type="checkbox" (change)="BilltoShiping($event.target.checked)" />
                                            <label for="acceptTerms" class="pl-2 mt-2">Copy Billing to Shipping
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <label class="col-form-label">Ship To :</label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="input-group">
                                                <textarea class="form-control " name="shippingAddress"
                                                    [value]="shippingaddress" formControlName="shippingaddress"
                                                    rows="14">
                                                </textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                       
                    </div>
                    <div class="col-sm-4">
                        <div class="mb-1">
                            <h4 class="text-center">Invoice</h4>
                        </div>
                        <div style="border:1px solid #ccc;">
                            <div class="form-group d-flex mt-2">
                                <div class="col-sm-6">
                                    <label class="col-form-label">Invoice Number :</label>
                                </div>
                                <div class="col-sm-6">
                                    <div class="input-group">
                                        <input name="invoiceNo" [(ngModel)]="this.InvoceObj.InvoiceNo"
                                            formControlName="invoiceno" class="form-control" type="text">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group d-flex">
                                <div class="col-sm-6">
                                    <label class="col-form-label">PO # :</label>
                                </div>
                                <div class="col-sm-6">
                                    <div class="input-group">
                                        <input maxlength="50" [(ngModel)]="this.InvoceObj.PurchaseOrder"
                                            formControlName="purchaseOrder" class="form-control" type="text">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group d-flex">
                                <div class="col-sm-6">
                                    <label class="col-form-label">Invoice Date :<span
                                        style="color: red">*</span></label>
                                </div>
                                <div class="col-sm-6">
                                    <div>
                                        <mat-form-field appearance="fill">
                                            <mat-label>Choose a date</mat-label>
                                            <input matInput [matDatepicker]="datepicker1" name="invoicedate"
                                                [(ngModel)]="InvoceObj.CreatedDate" formControlName="createdDate">
                                            <mat-datepicker-toggle matSuffix
                                                [for]="datepicker1"></mat-datepicker-toggle>
                                            <mat-datepicker #datepicker1></mat-datepicker>
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group d-flex">
                                <div class="col-sm-6">
                                    <label class="col-form-label">Terms :<span style="color: red">*</span>
                                    </label>
                                </div>
                                <div class="col-sm-6">
                                    <div class="input-group">
                                        <select formControlName="termsId" [(ngModel)]="InvoceObj.TermsID"
                                            class="form-control valid"
                                            [ngClass]="{'is-invalid':submitted && f.termsId.errors || !f.termsId.valid && f.termsId.touched && f.termsId.errors}">
                                            <option *ngFor="let term of teams" [value]="term.Id">
                                                {{term.Text}}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group d-flex">
                                <div class="col-sm-6">
                                    <label class="col-form-label">Due Date :<span style="color: red">*</span></label>
                                </div>
                                <div class="col-sm-6">
                                    <div>
                                        <mat-form-field appearance="fill">
                                            <mat-label>Choose a date</mat-label>
                                            <input matInput [matDatepicker]="picker1" name="dueDate"
                                                [(ngModel)]=" this.InvoceObj.DueDate" formControlName="duedate">
                                            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                                            <mat-datepicker #picker1></mat-datepicker>
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group d-flex">
                                <div class="col-sm-6">
                                    <label class="col-form-label">Recursive Invoice :<span
                                        style="color: red">*</span></label>
                                </div>
                                <div class="col-sm-6">
                                    <div class="input-group">
                                        <select tabindex="14" name="recursTerm" [(ngModel)]="InvoceObj.RecursTerm"
                                            formControlName="recursTerm" class="form-control  valid">
                                            <option *ngFor="let recurs of recurringInvoice" value="{{recurs.Value}}">
                                                {{recurs.Text}}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-sm-12">
                    <div class="table-responsive">
                        <table class="table table-bordered mb-2">
                            <thead>
                                <tr>
                                    <th>Item/Part #</th>
                                    <th>Description <span style="color: red">*</span></th>
                                    <th>Quantity <span style="color: red">*</span></th>
                                    <th>Sale Price ($)</th>
                                    <th>Total Amount ($)</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <input class="form-control " [(ngModel)]="forms.ItemCode"
                                            formControlName="itemcode">
                                    </td>
                                    <td>
                                        <div class="input-group">
                                            <input placeholder="Select Item" class="form-control " type="text"
                                                [(ngModel)]="forms.ItemName" formControlName="itemname">
                                            <span class="input-group-append">
                                                <a class="input-group-text"><i class="fa fa-search"
                                                        (click)="ShowItemsModal=true"></i>
                                                </a>
                                            </span>
                                            <input type="hidden" value="">
                                        </div>
                                    </td>
                                    <td>
                                        <input class="form-control  calcamount clsMax" [(ngModel)]="forms.Quantity"
                                            formControlName="quantity" (blur)="onitemtotal()">
                                    </td>
                                    <td>
                                        <input class="form-control  calcamount" [(ngModel)]="forms.RatePerUnit"
                                            formControlName="rateperunir">
                                        <input class="form-control input-sm Taxsumtot" type="hidden" value="">
                                    </td>
                                    <td><input class="form-control  sumtot" type="text" formControlName="itemtotal"
                                            [(ngModel)]="forms.ItemTotal">
                                    </td>
    
                                    <td>
                                        <button class="btn btn-success btn-sm btn-round has-ripple waves-effect waves-light" type="button" (click)="addForm()">
                                            <i class="fa fa-plus-circle pr-1"></i>Add
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                            <tbody>
                                <tr *ngFor="let item of InvoceObj.Listinvoiceitems; let i=index">
                                    <td>{{item.ItemName}}</td>
                                    <td>{{item.ItemCode}}</td>
                                    <td>{{item.Quantity}}</td>
                                    <td>{{item.RatePerUnit}}</td>
                                    <td>{{item.ItemTotal}}</td>
                                    <td>
                                        <button class="btn btn-sm  btn-danger" type="button"> <i class="fa fa-trash pr-1"
                                                (click)="delete(item,i)">
                                            </i>Delete</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="modal fade">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="float-left">
                                                <h5>Items List</h5>
                                            </div>
                                            <button type="button"
                                                class="  btn btn-light btn-sm has-ripple waves-effect waves-light float-right "
                                                data-dismiss="modal" aria-label="Close"><i class="fa fa-close"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-body">
                                    <div class="col-sm-12">
                                        <div class="page-body">

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-2 mb-3 border-bottom ml-1 mr-1">
                <div class="col-sm-8 offset-sm-4">
                    <div class="row">
                        <div class="col-sm-6">
                            <label class="col-form-label">Sub Total ($) :</label>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-group">
                                <input class="form-control text-right" [(ngModel)]="InvoceObj.InvoiceAmount"
                                    formControlName="invoiceAmount" type="text" name="total">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <label class="col-form-label">Discount (%) :
                            </label>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-group">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <input class="form-control text-right form-group" #discountpercent
                                            [(ngModel)]="this.InvoceObj.DiscountPercent"
                                            formControlName="discountPercent" type="text" name="discountPercent"
                                            (change)="onDiscountamt($event.target.value)">
                                    </div>
                                    <div class="col-sm-6">
                                        <input class="form-control text-right acceptdecimal" name="discount"
                                            [(ngModel)]="this.InvoceObj.Discount" formControlName="discount"
                                            type="text">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <label class="col-form-label">Tax (%) :</label>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-group">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <input class="form-control text-right form-group" maxlength="6"
                                            (change)="onTaxAmount($event.target.value)" #taxPercent
                                            [(ngModel)]="this.InvoceObj.TaxPercent" name="taxPercent"
                                            formControlName="taxPercent" type="text" value="">
                                    </div>
                                    <div class="col-sm-6">
                                        <input class="form-control text-right" type="text" name="taxAmount"
                                            [(ngModel)]="this.taxx" formControlName="taxamount">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <label class="col-form-label">Service Fee for Credit Card Transaction (%) :</label>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-group">
                                <input type="text" class="form-control text-right" id="txtService" name="ServiceFee"
                                    placeholder="3.5" readonly="readonly">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <label class="col-form-label">Total Invoice
                                (payable by check or cash) :</label>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-group">
                                <input class="form-control text-right" maxlength="6" #meterialpercent
                                    (change)="onMaterialAmount(discountpercent.value)" formControlName="meterialpercent"
                                    name="miscellaneouspercent" [(ngModel)]="this.InvoceObj.MaterialAmount"
                                    type="number">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <label class="col-form-label">Convenience :</label>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-group">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <input class="form-control form-group text-right" maxlength="6" #miscellaneouspercent
                                            type="number" name="meterialpercent"
                                            (change)="onMisellenousamt($event.target.value)"
                                            formControlName="miscellaneouspercent"
                                            [(ngModel)]="this.InvoceObj.MiscellaneousPercent">
                                    </div>
                                    <div class="col-sm-6">
                                        <input class="form-control text-right " name="miscellaneousAmount"
                                            [(ngModel)]=" this.conveniences" for formControlName="miscellaneousAmount"
                                            type="number">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <label class="col-form-label">Grand Total($) :</label>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-group">
                                <input class="form-control text-right" [(ngModel)]="this.Granddtotalamt"
                                    formControlName="grandTotal" type="text" name="grandTotal" value="">
                            </div>
                        </div>
                    </div>
                    <!-- <div class="col-sm-12">
                        <div class="form-group no-margin-hr">
                            <label class="col-form-label"
                                style="float:left;width:20%;margin-bottom:-50px;margin-top: -1px;margin-left:655px;">sub Total($)&nbsp;:</label>
                            <div class="col-sm-3" style="float:right;width:18%;margin-right:47px;">

                                <input class="form-control form-control1 input-sm" style="text-align:right;margin-left: 7px;" [(ngModel)]="InvoceObj.InvoiceAmount"
                                    formControlName="invoiceAmount"  type="text" name="total">
                            </div>
                        </div>
                    </div> -->
                </div>
            </div>
        </form>

        <app-card cardTitle="Notes">
            <div class="row">
                <div class="col-sm-12">
                    <app-tinymce #tinymce="tinymce"></app-tinymce>
                </div>
            </div>
        </app-card>

    </app-card>

</app-card>


<app-iteam-modal *ngIf="ShowItemsModal" (itemmodelstatus)="onitemmodelstatus($event)"
    (status)="saveStatus($event)"></app-iteam-modal>
<app-company-model *ngIf="ShowCompanyModal" (companylistmodalstatus)="oncompanylistmodalstatus($event)"
    (status)="saveStatus($event)"></app-company-model>
<app-invoicemailing-template  
    [companylogo]="companylogo"
    [model]="model"
    [userDetails]="userDetails"
    [InvoceObj]="InvoceObj"
    [billingaddress]="billingaddress"
    [clientDetails]="clientDetails">
</app-invoicemailing-template>